<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tailwind Playground</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: "Plus Jakarta Sans", sans-serif; background: linear-gradient(135deg,#f0f4ff 0%,#e6e6ff 100%); color:#334155; min-height:100vh; }
  .header-gradient { background: linear-gradient(135deg,#6366f1 0%,#8b5cf6 50%,#ec4899 100%); }
  .editor-container { clip-path: polygon(0 0,100% 0,100% 90%,90% 100%,0 100%); transition:all 0.3s ease; }
  .preview-container { border-radius: 2rem 0 2rem 0; background:linear-gradient(135deg,#f0ebff 0%,#d9b3ff 100%); transition:all 0.3s ease; }
  .code-editor { scrollbar-width:thin; scrollbar-color:#6366f1 #1f2937; }
  .status-indicator { transition:all 0.3s ease; }
  .floating-btn { transition: all 0.3s ease; }
  .error-panel { max-height:0; overflow:hidden; transition:max-height 0.3s ease-out; }
  .error-panel.open { max-height:150px; }
  .game-btn { transition: all 0.2s ease; }
  #welcome-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.7); display: flex;
    align-items: center; justify-content: center; z-index: 1000;
  }
</style>
</head>
<body class="min-h-screen flex flex-col">

<!-- Header -->
<header class="header-gradient shadow-lg">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-white">Tailwind Playground</h1>
    <div id="user-info" class="text-white text-sm bg-white/20 px-3 py-1 rounded-full">
      <i class="fas fa-user mr-1"></i>
      <span id="username-display">Not logged in</span>
      <span class="ml-2 px-2 py-1 bg-purple-500 rounded-full text-xs" id="user-level">Level 1</span>
    </div>
  </div>
</header>

<main class="flex-1 p-6">
  <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Left side: editor + game buttons + error panel -->
    <div class="flex flex-col h-full">
      <div class="bg-gray-800 shadow-xl rounded-t-xl overflow-hidden editor-container border-2 border-indigo-500">
        <div class="px-4 py-3 bg-indigo-900 border-b border-indigo-700 flex justify-between items-center">
          <h2 class="text-lg font-bold text-white"><i class="fas fa-code mr-2"></i>Editor</h2>
          <div class="flex items-center space-x-3">
            <select id="level-select" class="border rounded px-3 py-1 text-sm bg-indigo-800 text-white">
              <option value="Beginner">Beginner</option>
              <option value="Intermediate">Intermediate</option>
              <option value="Expert">Expert</option>
            </select>
            <button id="run-button" class="floating-btn px-4 py-2 bg-green-600 text-white rounded-lg text-sm flex items-center font-medium"><i class="fas fa-play-circle mr-2"></i>Run</button>
            <button id="save-button" class="floating-btn px-3 py-2 bg-blue-600 text-white rounded-lg text-sm flex items-center font-medium"><i class="fas fa-save mr-1"></i></button>
          </div>
        </div>
        <textarea id="code-editor" class="code-editor w-full h-96 p-4 bg-gray-900 text-green-300 resize-none font-mono text-sm"></textarea>
      </div>

      <!-- Error Panel -->
      <div id="error-panel" class="error-panel mt-4 bg-red-50 border border-red-200 rounded-lg overflow-hidden">
        <div class="px-4 py-2 bg-red-100 border-b border-red-200 flex justify-between items-center">
          <h3 class="font-semibold text-red-800"><i class="fas fa-exclamation-circle mr-2"></i>Errors</h3>
          <button id="error-toggle" class="text-red-600"><i class="fas fa-chevron-up"></i></button>
        </div>
        <div class="p-4"><ul id="error-list" class="text-red-700 text-sm"></ul></div>
      </div>

      <!-- Game Buttons -->
      <div class="mt-6 flex flex-wrap gap-3">
        <button id="login-btn" class="game-btn bg-blue-600 text-white px-4 py-2 rounded-lg">Login</button>
        <button id="start-level-btn" class="game-btn bg-blue-500 text-white px-4 py-2 rounded-lg">Start Level</button>
        <button id="make-error-btn" class="game-btn bg-red-600 text-white px-4 py-2 rounded-lg">Make Error</button>
        <button id="finish-level-btn" class="game-btn bg-green-600 text-white px-4 py-2 rounded-lg">Finish Level</button>
        <button id="level-back-btn" class="game-btn bg-yellow-600 text-white px-4 py-2 rounded-lg">Level Back</button>
        <button id="show-users-btn" class="game-btn bg-purple-600 text-white px-4 py-2 rounded-lg">Show Users</button>
        <button id="exit-game-btn" class="game-btn bg-gray-600 text-white px-4 py-2 rounded-lg">Exit Game</button>
      </div>
    </div>

    <!-- Right side: preview + saved snippets -->
    <div class="flex flex-col h-full">
      <div class="preview-container shadow-xl overflow-hidden border-2 border-purple-500 h-96">
        <div class="px-4 py-3 bg-purple-200 border-b border-purple-300 flex items-center">
          <h2 class="text-lg font-bold text-purple-800"><i class="fas fa-eye mr-2"></i>Live Preview</h2>
          <span id="status-indicator" class="ml-2 text-xs bg-purple-300 text-purple-800 px-2 py-1 rounded-full">Ready</span>
        </div>
        <div id="live-preview" class="h-full w-full bg-gradient-to-b from-purple-50 to-purple-100 overflow-auto p-4"></div>
      </div>

      <!-- Saved snippets -->
      <div class="mt-6 bg-white p-6 rounded-xl shadow-md border border-gray-200">
        <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center justify-between">
          <span><i class="fas fa-database text-blue-500 mr-2"></i>Saved Snippets</span>
          <span id="saved-count" class="text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded-full">0</span>
        </h3>
        <div class="mb-4 flex space-x-2">
          <input type="text" id="save-name" placeholder="Name your code"
            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"/>
          <button id="save-new-button" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save</button>
        </div>
        <div id="saved-items" class="border border-gray-200 rounded-lg overflow-hidden">
          <div class="bg-gray-50 px-4 py-2 text-sm text-gray-500">No saved code yet</div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Welcome Modal -->
<div id="welcome-modal">
  <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
    <div class="header-gradient p-6 text-center">
      <h2 class="text-2xl font-bold text-white">Welcome ðŸŽ‰</h2>
    </div>
    <div class="p-6">
      <button id="welcome-close" class="w-full bg-indigo-600 text-white font-medium py-3 rounded-lg">Get Started</button>
    </div>
  </div>
</div>

<script>
const API="http://localhost:3000";
let currentUser=null,currentLevel=1,currentErrors=0,currentType=null;
let savedItems=JSON.parse(localStorage.getItem('savedItems'))||[];

// --- Game handlers ---
async function handleStartLevel(){ if(!currentUser)return alert("Login first!");
  const res=await fetch(`${API}/start-level`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:currentUser,type:currentType,level:currentLevel})});
  const d=await res.json(); alert(`Level ${currentLevel} started. Attempts: ${d.attempts}, Errors: ${d.errors}`);}
function handleMakeError(){ if(!currentUser)return alert("Login first!"); currentErrors++; alert(`Error count: ${currentErrors}`);}
async function handleFinishLevel(){ if(!currentUser)return alert("Login first!");
  const res=await fetch(`${API}/finish-level`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:currentUser,type:currentType,level:currentLevel,errors:currentErrors})});
  const d=await res.json(); currentLevel=d.userLevel; localStorage.setItem("currentLevel",currentLevel); document.getElementById("user-level").textContent=`Level ${currentLevel}`; alert(`Finished! Level ${currentLevel}`);}
async function handleLevelBack(){ if(!currentUser)return alert("Login first!");
  const res=await fetch(`${API}/level-back`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:currentUser})});
  const d=await res.json(); currentLevel=d.userLevel; localStorage.setItem("currentLevel",currentLevel); document.getElementById("user-level").textContent=`Level ${currentLevel}`; alert(`Moved back to ${currentLevel}`);}
async function handleShowUsers(){ const res=await fetch(`${API}/users`); const users=await res.json(); alert("Users:\n"+JSON.stringify(users,null,2));}
async function handleLogin(){ const username=prompt("Enter username:")||"player1"; const type=document.getElementById('level-select').value;
  const res=await fetch(`${API}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,type})});
  const d=await res.json(); if(d.error)return alert(d.error); currentUser=username; currentType=type; currentLevel=d.level; currentErrors=0;
  localStorage.setItem("currentUser",username); localStorage.setItem("currentLevel",currentLevel); localStorage.setItem("currentType",currentType);
  document.getElementById('username-display').textContent=username; document.getElementById('user-level').textContent=`Level ${currentLevel}`;
  document.getElementById("welcome-modal").style.display="none"; alert(`Logged in as ${username}`);}
function handleExitGame(){ currentUser=null;currentLevel=1;currentErrors=0;currentType=null;
  document.getElementById('username-display').textContent="Not logged in"; document.getElementById('user-level').textContent="Level 1"; localStorage.clear(); alert("Exited game");}

// --- Editor/preview ---
function runCode(){const ed=document.getElementById("code-editor");const pv=document.getElementById("live-preview");const st=document.getElementById("status-indicator");
  try{pv.innerHTML=ed.value; st.textContent="Success"; st.classList.remove("bg-red-300"); st.classList.add("bg-green-300");
    document.getElementById('error-list').innerHTML=''; document.getElementById('error-panel').classList.remove('open');}
  catch(e){st.textContent="Error"; st.classList.add("bg-red-300"); document.getElementById('error-list').innerHTML=`<li>${e.message}</li>`; document.getElementById('error-panel').classList.add('open');}}

// --- Save/load ---
function saveCode(){const nameInput=document.getElementById('save-name');const editor=document.getElementById('code-editor');const name=nameInput.value.trim()||`Snippet ${savedItems.length+1}`;
  if(editor.value.trim()){savedItems.push({name,code:editor.value}); localStorage.setItem('savedItems',JSON.stringify(savedItems)); updateSavedItemsList(); nameInput.value='';}}
function updateSavedItemsList(){const c=document.getElementById('saved-items');document.getElementById('saved-count').textContent=savedItems.length;
  if(savedItems.length===0){c.innerHTML='<div class="bg-gray-50 px-4 py-2 text-sm text-gray-500">No saved code yet</div>';return;}
  c.innerHTML=savedItems.map((it,i)=>`<div class="flex justify-between px-4 py-3 border-b"><div>${it.name}</div><div><button class="load-btn text-blue-600" data-i="${i}">Load</button><button class="delete-btn text-red-600 ml-2" data-i="${i}">Del</button></div></div>`).join('');
  document.querySelectorAll('.load-btn').forEach(b=>b.onclick=e=>{const i=e.target.dataset.i;document.getElementById('code-editor').value=savedItems[i].code;runCode();});
  document.querySelectorAll('.delete-btn').forEach(b=>b.onclick=e=>{const i=e.target.dataset.i;savedItems.splice(i,1);localStorage.setItem('savedItems',JSON.stringify(savedItems));updateSavedItemsList();});}

// --- Init ---
document.addEventListener("DOMContentLoaded",()=>{
  const welcomeModal=document.getElementById("welcome-modal"); const savedUser=localStorage.getItem("currentUser");
  if(savedUser){currentUser=savedUser;currentLevel=parseInt(localStorage.getItem("currentLevel"))||1;currentType=localStorage.getItem("currentType")||null;
    document.getElementById('username-display').textContent=currentUser;document.getElementById('user-level').textContent=`Level ${currentLevel}`;welcomeModal.style.display="none";}
  document.getElementById("welcome-close").onclick=()=>welcomeModal.style.display="none";
  document.getElementById("login-btn").onclick=handleLogin;
  document.getElementById("exit-game-btn").onclick=handleExitGame;
  document.getElementById("start-level-btn").onclick=handleStartLevel;
  document.getElementById("make-error-btn").onclick=handleMakeError;
  document.getElementById("finish-level-btn").onclick=handleFinishLevel;
  document.getElementById("level-back-btn").onclick=handleLevelBack;
  document.getElementById("show-users-btn").onclick=handleShowUsers;
  document.getElementById("run-button").onclick=runCode;
  document.getElementById("save-button").onclick=saveCode;
  document.getElementById("save-new-button").onclick=saveCode;
  document.getElementById("error-toggle").onclick=()=>{const p=document.getElementById("error-panel");p.classList.toggle("open");};
  updateSavedItemsList();
  document.getElementById("code-editor").value="<!-- Welcome! -->\n<div class='p-4 bg-white rounded shadow'>Hello Tailwind</div>";
  runCode();
});
</script>
</body>
</html>